#!/bin/sh

set -e

CONFFILE="/etc/nss-ldapd.conf"

# source debconf library.
. /usr/share/debconf/confmodule
db_version 2.0

# set title
db_title "Configuring libnss-ldapd"

# parse /etc/nsswitch.conf and see which services have ldap specified
db_get libnss-ldapd/nsswitch
if [ -z "$RET" ]
then
  # find name services that currently use LDAP
  configured=`sed -n 's/^\([a-z]*\):.*[[:space:]]ldap\([[:space:]].*\)\?/\1/p' /etc/nsswitch.conf`
  # separate by commas
  configured=`echo $configured | sed 's/ /, /g'`
  # store configured services
  db_set libnss-ldapd/nsswitch "$configured"
fi

# ask for which nsswitch options to configure
db_capb multiselect
db_input high libnss-ldapd/nsswitch || true
db_go || true

exit 0
